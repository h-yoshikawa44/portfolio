---
id: docker-work
title: Docker - 仕組み
sidebar_label: 仕組み
description: Dockerの仕組みと、従来の仮想化との比較まとめ
keywords:
  - Docker
---

## 概要
Docker は、ホスト OS 上でコンテナという仮想環境を作成して管理する。  
このコンテナは従来のホスト型仮想環境のようにゲスト OS を使うのでなく、ホスト OS のカーネルを使用して動作する。そのため、動作は比較的軽量。

コンテナはイメージというコンテナの土台となるものをベースとして作成されるため、このイメージを共有することで、同様の環境を再現することや環境の作り直しも容易に行える。

## 従来の仮想化（ホスト型）とコンテナ型仮想化の比較
主な違いとしては以下のようなものがある。

### 構成
|ホスト型仮想化|コンテナ型仮想化|
|---|---|
|VM1（複数可能）<br />　アプリA<br />　バイナリ/ライブラリ<br />　ゲスト OS<br />ハイパーバイザー<br />ホストOS<br />インフラストラクチャー|コンテナ１（複数可能）<br />　アプリA<br />　バイナリ/ライブラリ<br />Docker Engine<br />ホストOS<br />インフラストラクチャー|

### 仮想化のオーバーヘッド
|ホスト型仮想化|コンテナ型仮想化|
|---|---|
|リソース（CPU やメモリの使用率など）の面で、オーバーヘッドが多く、起動や停止にも時間がかかる。|コンテナはアプリケーション実行に必要な物だけを含み、ホスト OS のカーネルを使用するため、動作が早くリソースの使用率も少なくて済む。|

### アプリケーション実行の再現性
|ホスト型仮想化|コンテナ型仮想化|
|---|---|
|仮想マシンの環境の違いにより、アプリケーションが動作しなくなることがまれに発生する。|特定のアプリケーションを動作するために必要な物は、Dockerイメージにまとまっており、同じDockerイメージからコンテナを起動する限り、環境が変わっても同様に動作する。|

### OSの自由度
|ホスト型仮想化|コンテナ型仮想化|
|---|---|
|仮想マシン上で任意の OS を動作させることができる|コンテナはホスト OS のカーネルを使用して動作するので、 Windows OS 上で直接 Linux コンテナは動作させることができない。また Linux OS 上で直接 Windows コンテナも動作させることもできない|

### 分離レベル
|ホスト型仮想化|コンテナ型仮想化|
|---|---|
|ハードウェアレベルで仮想化されており、ホスト OS や仮想マシン間の分離レベルが高く、それぞれが影響を受けにくい。| OS の機能を使用した仮想化は、従来の仮想化に比べて分離レベルは低い。|

## データの管理
ここでの`マウント`とは同期を行うものと考えるとよい。

### volume
volume の作成。
```bash
$ docker volume create
```

ホスト上の Docker 領域（Linux の場合`/var/lib/docker/volumes`配下）のディレクトリをコンテナ内にマウントする。  
それを複数のコンテナにマウントして、コンテナ間でファイル共有ができる。

この`/var/lib/docker/volumes`は、ホスト上では直接操作すべきでない領域で、あくまでコンテナ上でファイルを管理するようにすることを推奨。

### bind mount
volume とは違い、ユーザの管理しているファイルやディレクトリをコンテナにマウントする。

### tmpfs
ホストのメモリ領域をディレクトリとしてコンテナにマウントする。  
メモリ上にデータが置かれるので、キャッシュなど一時的にデータを保持するものに向いている。